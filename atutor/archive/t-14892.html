---
 title: Cannot login after upgrade to 161
---
<div class='threadlist'>
<br /><div><a href='exported_forum1.html' class='midtext'>Back to: Thread list</a></div>
<br /><br /><div><strong>Pages:</strong><a href="exported_forum1.html?page=1">1</a> <a href="exported_forum2.html?page=2">2</a> <a href="exported_forum3.html?page=3">3</a> <a href="exported_forum4.html?page=4">4</a> <a href="exported_forum5.html?page=5">5</a> <strong><a href="exported_forum6.html">6</a></strong> <a href="exported_forum7.html?page=7">7</a> <a href="exported_forum8.html?page=8">8</a> <a href="exported_forum9.html?page=9">9</a> <a href="exported_forum10.html?page=10">10</a> <a href="exported_forum11.html?page=11">11</a> <a href="exported_forum12.html?page=12">12</a> <a href="exported_forum13.html?page=13">13</a> <a href="exported_forum14.html?page=14">14</a> <a href="exported_forum15.html?page=15">15</a> </div>
<div><p><br /><h3>Cannot login after upgrade to 161</h3></div><br />
<div><ul class='forum-thread'>

	<li class="even">
		<a name="14892"></a>
		<div class="forum-post-author">
			<label class="title">joecarr</label><br />
		</div>

		<div class="forum-post-content">
			
			<div class="date">
                <p>2008-08-22 17:35:51</p>
            </div>
            <div class="postheader"><h3>Cannot login after upgrade to 161</h3></div>
				
			<div class="body">
				<p>After upgrading to 1.6.1, I cannot login with any account (admin or not).  When I try to create a new account, I apparently have to have a pin (which I do not recall setting up in the past).<br />
<br />
When I debug the code in the login.php script, I see the encrypted password changes and subsequently does not match the encrypted password stored in the database.<br />
<br />
For example, I cleared out the admin password and encrypted a blank password with SHA1.  When I look at the value for the password that is queried, it changes.<br />
<br />
The following are all blank password values that were generated by the login.php script when I attempted to login:<br />
<br />
ec531bd3a34201befa6a88e0e8c08e919fa1eb14<br />
<br />
ef40834bbb8bcd36cffef61240491895fef557b2<br />
<br />
530bf138e8512976ddacca1546b5cfa4c0c1829c<br />
<br />
09464b367c345a53f056413398fa61eb1a765b83<br />
<br />
<br />
This is an example of the SQL generated to check the admin table for my admin account with a blank password:<br />
<br />
SELECT login, `privileges`, language FROM AT_admins WHERE login='admin' AND password='09464b367c345a53f056413398fa61eb1a765b83' AND `privileges`>0<br />
<br />
How can I successfully login if the encrypted values of the password keep changing?  Can I turn the encryption off?<br />
<br />
Thanks in advance for your help!</p>
			</div>
		</div>
	</li>

	<li class="odd">
		<a name="14893"></a>
		<div class="forum-post-author">
			<label class="title">joecarr</label><br />
		</div>

		<div class="forum-post-content">
			
			<div class="date">
                <p>2008-08-22 17:56:05</p>
            </div>
            <div class="postheader"><h3>Re: Cannot login after upgrade to 1.6.1</h3></div>
				
			<div class="body">
				<p>I was able to turn off the master list and email verification in the database.<br />
<br />
I still have the same problem...with the new users that I have created, the encrypted password that is used to query the member table does not match what is there (yes...I am sure that I am typing the right password).<br />
<br />
Thanks in advance for your help!<br />
<br />
[reply][b]In reply to:[/b]<br />
After upgrading to 1.6.1, I cannot login with any account (admin or not).  When I try to create a new account, I apparently have to have a pin (which I do not recall setting up in the past).<br />
<br />
When I...<br />
[op]forums/view.php?fid=7;pid=14892;page=1#14892[/op][/reply]</p>
			</div>
		</div>
	</li>

	<li class="even">
		<a name="14905"></a>
		<div class="forum-post-author">
			<label class="title">cindy</label><br />
		</div>

		<div class="forum-post-content">
			
			<div class="date">
                <p>2008-08-25 09:35:56</p>
            </div>
            <div class="postheader"><h3>Re: Cannot login after upgrade to 1.6.1</h3></div>
				
			<div class="body">
				<p>Hi,<br />
<br />
Thanks for report.<br />
<br />
A few questions:<br />
<br />
1. which theme are you using? Is it ATutor default theme?<br />
2. Is the SQL in your first thread generated from original 1.6.1 login.php? Or from your modified code?<br />
<br />
The original 1.6.1 login.php should generate SQL like this for admin login:<br />
<br />
SELECT login, `privileges`, language FROM AT_admins WHERE login='admin' AND SHA1(CONCAT(password, '9b263a9d3423285a8dd37388f99aea1e28ede99e'))='a5787d27f542659675251bdf2a377a3a850030d9' AND `privileges`>0;<br />
<br />
Can you attach the listed files from your ATutor 1.6.1, (the paths are relative to ATutor_root):<br />
login.php<br />
sha-1factory.js<br />
themes/default/login.tmpl.php (if you are using ATutor default theme, otherwise, path "default" should be the theme folder that's in use)<br />
<br />
Thanks.</p>
			</div>
		</div>
	</li>

	<li class="odd">
		<a name="14923"></a>
		<div class="forum-post-author">
			<label class="title">joecarr</label><br />
		</div>

		<div class="forum-post-content">
			
			<div class="date">
                <p>2008-08-25 17:10:31</p>
            </div>
            <div class="postheader"><h3>Re: Cannot login after upgrade to 1.6.1</h3></div>
				
			<div class="body">
				<p>I am usin the stock login.php (short of my debugging code to see what was going on).  I am also using the default theme. I will attache the files.<br />
<br />
I will also try doing a fresh install and copying the files you mention to the install in question.  Thanks!<br />
<br />
[reply][b]In reply to:[/b]<br />
Hi,<br />
<br />
Thanks for report.<br />
<br />
A few questions:<br />
<br />
1. which theme are you using? Is it ATutor default theme?<br />
2. Is the SQL in your first thread generated from original 1.6.1 login.php? Or from your mod...<br />
[op]forums/view.php?fid=7;pid=14892;page=1#14905[/op][/reply]</p>
			</div>
		</div>
	</li>

	<li class="even">
		<a name="14925"></a>
		<div class="forum-post-author">
			<label class="title">IndieRect</label><br />
		</div>

		<div class="forum-post-content">
			
			<div class="date">
                <p>2008-08-26 03:30:56</p>
            </div>
            <div class="postheader"><h3>Re: Cannot login after upgrade to 1.6.1</h3></div>
				
			<div class="body">
				<p>Cindy, the SQL query you've written is not from the original 1.6.1 but from my patch 0007.<br />
<br />
I guess the error might be caused by partially failed patching with 0007. Looks like the JavaScript part has been patched, but SQL hasn't.<br />
<br />
Did you install patch 0007, Joe?</p>
			</div>
		</div>
	</li>

	<li class="odd">
		<a name="14929"></a>
		<div class="forum-post-author">
			<label class="title">cindy</label><br />
		</div>

		<div class="forum-post-content">
			
			<div class="date">
                <p>2008-08-26 09:02:49</p>
            </div>
            <div class="postheader"><h3>Re: Cannot login after upgrade to 1.6.1</h3></div>
				
			<div class="body">
				<p>Thanks for correcting me, Indie. You are right, I was looking at the login.php after patch instead of the original one.<br />
<br />
Joe, the problem is in themes/default/login.tmpl.php, Line 10. This line in the 1.6.1 original one should be:<br />
<br />
document.form.form_password_hidden.value = hex_sha1(document.form.form_password.value);<br />
<br />
What you have is after installing patch 0007. This patch also updates login.php but somehow your login.php is not updated accordingly, still the 1.6.1 original one. <br />
<br />
I wonder how this could happen even if you did install patch 0007. Patcher prevents you proceed with installation as long as there's files need to be updated but patcher doesn't have permission to write.</p>
			</div>
		</div>
	</li>

	<li class="even">
		<a name="14936"></a>
		<div class="forum-post-author">
			<label class="title">IndieRect</label><br />
		</div>

		<div class="forum-post-content">
			
			<div class="date">
                <p>2008-08-26 13:39:36</p>
            </div>
            <div class="postheader"><h3>Re: Cannot login after upgrade to 1.6.1</h3></div>
				
			<div class="body">
				<p>I suspected that. The reason might be imperfect handling of any customization in relevant parts of the code, as per http://www.atutor.ca/atutor/mantis/view.php?id=3541 .</p>
			</div>
		</div>
	</li>

	<li class="odd">
		<a name="14987"></a>
		<div class="forum-post-author">
			<label class="title">joecarr</label><br />
		</div>

		<div class="forum-post-content">
			
			<div class="date">
                <p>2008-09-02 11:34:35</p>
            </div>
            <div class="postheader"><h3>Re: Cannot login after upgrade to 1.6.1</h3></div>
				
			<div class="body">
				<p>Thanks for the info...I did not install patch 0007...how can I get it?</p>
			</div>
		</div>
	</li>

	<li class="even">
		<a name="14988"></a>
		<div class="forum-post-author">
			<label class="title">cindy</label><br />
		</div>

		<div class="forum-post-content">
			
			<div class="date">
                <p>2008-09-02 11:40:28</p>
            </div>
            <div class="postheader"><h3>Re: Cannot login after upgrade to 1.6.1</h3></div>
				
			<div class="body">
				<p>Which 1.6.1 zip file you downloaded? ATutor-1.6.1_pl1.tar.gz?</p>
			</div>
		</div>
	</li>

	<li class="odd">
		<a name="14989"></a>
		<div class="forum-post-author">
			<label class="title">joecarr</label><br />
		</div>

		<div class="forum-post-content">
			
			<div class="date">
                <p>2008-09-02 11:48:44</p>
            </div>
            <div class="postheader"><h3>Re: Cannot login after upgrade to 1.6.1</h3></div>
				
			<div class="body">
				<p>Yes...pl1</p>
			</div>
		</div>
	</li>

	<li class="even">
		<a name="14990"></a>
		<div class="forum-post-author">
			<label class="title">IndieRect</label><br />
		</div>

		<div class="forum-post-content">
			
			<div class="date">
                <p>2008-09-02 12:01:58</p>
            </div>
            <div class="postheader"><h3>Re: Cannot login after upgrade to 1.6.1</h3></div>
				
			<div class="body">
				<p>Could you please log in as an admin and go to the Patcher tab. There you should see patch 0007. What does it Status read?<br />
<br />
I didn't see the code of your login.php file but the SQL query you've posted looks like it [i]must[/i] have something to do with that patch.</p>
			</div>
		</div>
	</li>

	<li class="odd">
		<a name="14991"></a>
		<div class="forum-post-author">
			<label class="title">harris</label><br />
		</div>

		<div class="forum-post-content">
			
			<div class="date">
                <p>2008-09-02 12:12:00</p>
            </div>
            <div class="postheader"><h3>Re: Cannot login after upgrade to 1.6.1</h3></div>
				
			<div class="body">
				<p>Do you have any other admins in your system that might had run the patch?<br />
<br />
Edited:<br />
Also check under your themes/default/ folder and see if you can find any *.old files?<br />
ie. login.tmpl.php.0007.old</p>
			</div>
		</div>
	</li>
</ul></div>
